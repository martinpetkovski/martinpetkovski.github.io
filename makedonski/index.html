<!DOCTYPE html>
<html lang="mk">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Македонски Лексикон  Речник и Игри</title>
<link rel="icon" type="image/jpg" href="../favicon.jpg">
<style>
*{box-sizing:border-box}
body{font-family:Verdana,Tahoma,Arial,sans-serif;font-size:13px;background:#f4f7ff;color:#0b1020;padding:0;margin:0;line-height:1.45}
.page{background:transparent;border:0;padding:0;max-width:640px;margin:0 auto}
.hdr{background-color:#4a7fc4;background-image:url("data:image/svg+xml,%3Csvg%20xmlns='http://www.w3.org/2000/svg'%20width='320'%20height='80'%20viewBox='0%200%20320%2080'%20shape-rendering='crispEdges'%3E%3Cdefs%3E%3ClinearGradient%20id='m'%20x1='0%2525'%20y1='0%2525'%20x2='100%2525'%20y2='0%2525'%3E%3Cstop%20offset='0%2525'%20stop-color='%23000'%20stop-opacity='0'/%3E%3Cstop%20offset='48%2525'%20stop-color='%23000'%20stop-opacity='0'/%3E%3Cstop%20offset='78%2525'%20stop-color='%23fff'%20stop-opacity='1'/%3E%3Cstop%20offset='100%2525'%20stop-color='%23fff'%20stop-opacity='1'/%3E%3C/linearGradient%3E%3Cmask%20id='fade'%3E%3Crect%20width='320'%20height='80'%20fill='url(%23m)'/%3E%3C/mask%3E%3C/defs%3E%3Cg%20mask='url(%23fade)'%3E%3Crect%20x='128'%20y='0'%20width='16'%20height='16'%20fill='%23fff'%20opacity='0.02'/%3E%3Crect%20x='144'%20y='0'%20width='16'%20height='16'%20fill='%23fff'%20opacity='0.09'/%3E%3Crect%20x='160'%20y='0'%20width='16'%20height='16'%20fill='%23fff'%20opacity='0.1'/%3E%3Crect%20x='176'%20y='0'%20width='16'%20height='16'%20fill='%23fff'%20opacity='0.17'/%3E%3Crect%20x='192'%20y='0'%20width='16'%20height='16'%20fill='%23fff'%20opacity='0.34'/%3E%3Crect%20x='208'%20y='0'%20width='16'%20height='16'%20fill='%23fff'%20opacity='0.28'/%3E%3Crect%20x='224'%20y='0'%20width='16'%20height='16'%20fill='%23fff'%20opacity='0.49'/%3E%3Crect%20x='240'%20y='0'%20width='16'%20height='16'%20fill='%23fff'%20opacity='0.36'/%3E%3Crect%20x='256'%20y='0'%20width='16'%20height='16'%20fill='%23fff'%20opacity='0.63'/%3E%3Crect%20x='272'%20y='0'%20width='16'%20height='16'%20fill='%23fff'%20opacity='0.15'/%3E%3Crect%20x='288'%20y='0'%20width='16'%20height='16'%20fill='%23fff'%20opacity='0.91'/%3E%3Crect%20x='304'%20y='0'%20width='16'%20height='16'%20fill='%23fff'%20opacity='1'/%3E%3Crect%20x='128'%20y='16'%20width='16'%20height='16'%20fill='%23fff'%20opacity='0.02'/%3E%3Crect%20x='144'%20y='16'%20width='16'%20height='16'%20fill='%23fff'%20opacity='0.05'/%3E%3Crect%20x='160'%20y='16'%20width='16'%20height='16'%20fill='%23fff'%20opacity='0.18'/%3E%3Crect%20x='176'%20y='16'%20width='16'%20height='16'%20fill='%23fff'%20opacity='0.15'/%3E%3Crect%20x='192'%20y='16'%20width='16'%20height='16'%20fill='%23fff'%20opacity='0.28'/%3E%3Crect%20x='208'%20y='16'%20width='16'%20height='16'%20fill='%23fff'%20opacity='0.3'/%3E%3Crect%20x='224'%20y='16'%20width='16'%20height='16'%20fill='%23fff'%20opacity='0.55'/%3E%3Crect%20x='240'%20y='16'%20width='16'%20height='16'%20fill='%23fff'%20opacity='0.51'/%3E%3Crect%20x='256'%20y='16'%20width='16'%20height='16'%20fill='%23fff'%20opacity='0.44'/%3E%3Crect%20x='272'%20y='16'%20width='16'%20height='16'%20fill='%23fff'%20opacity='0.47'/%3E%3Crect%20x='288'%20y='16'%20width='16'%20height='16'%20fill='%23fff'%20opacity='0.81'/%3E%3Crect%20x='304'%20y='16'%20width='16'%20height='16'%20fill='%23fff'%20opacity='0.78'/%3E%3Crect%20x='128'%20y='32'%20width='16'%20height='16'%20fill='%23fff'%20opacity='0.02'/%3E%3Crect%20x='144'%20y='32'%20width='16'%20height='16'%20fill='%23fff'%20opacity='0.04'/%3E%3Crect%20x='160'%20y='32'%20width='16'%20height='16'%20fill='%23fff'%20opacity='0.16'/%3E%3Crect%20x='176'%20y='32'%20width='16'%20height='16'%20fill='%23fff'%20opacity='0.27'/%3E%3Crect%20x='192'%20y='32'%20width='16'%20height='16'%20fill='%23fff'%20opacity='0.36'/%3E%3Crect%20x='208'%20y='32'%20width='16'%20height='16'%20fill='%23fff'%20opacity='0.44'/%3E%3Crect%20x='224'%20y='32'%20width='16'%20height='16'%20fill='%23fff'%20opacity='0.55'/%3E%3Crect%20x='240'%20y='32'%20width='16'%20height='16'%20fill='%23fff'%20opacity='0.44'/%3E%3Crect%20x='256'%20y='32'%20width='16'%20height='16'%20fill='%23fff'%20opacity='0.61'/%3E%3Crect%20x='272'%20y='32'%20width='16'%20height='16'%20fill='%23fff'%20opacity='0.34'/%3E%3Crect%20x='288'%20y='32'%20width='16'%20height='16'%20fill='%23fff'%20opacity='0.89'/%3E%3Crect%20x='304'%20y='32'%20width='16'%20height='16'%20fill='%23fff'%20opacity='0.88'/%3E%3Crect%20x='128'%20y='48'%20width='16'%20height='16'%20fill='%23fff'%20opacity='0.02'/%3E%3Crect%20x='144'%20y='48'%20width='16'%20height='16'%20fill='%23fff'%20opacity='0.04'/%3E%3Crect%20x='160'%20y='48'%20width='16'%20height='16'%20fill='%23fff'%20opacity='0.15'/%3E%3Crect%20x='176'%20y='48'%20width='16'%20height='16'%20fill='%23fff'%20opacity='0.2'/%3E%3Crect%20x='192'%20y='48'%20width='16'%20height='16'%20fill='%23fff'%20opacity='0.25'/%3E%3Crect%20x='208'%20y='48'%20width='16'%20height='16'%20fill='%23fff'%20opacity='0.3'/%3E%3Crect%20x='224'%20y='48'%20width='16'%20height='16'%20fill='%23fff'%20opacity='0.35'/%3E%3Crect%20x='240'%20y='48'%20width='16'%20height='16'%20fill='%23fff'%20opacity='0.6'/%3E%3Crect%20x='256'%20y='48'%20width='16'%20height='16'%20fill='%23fff'%20opacity='0.73'/%3E%3Crect%20x='272'%20y='48'%20width='16'%20height='16'%20fill='%23fff'%20opacity='0.6'/%3E%3Crect%20x='288'%20y='48'%20width='16'%20height='16'%20fill='%23fff'%20opacity='0.59'/%3E%3Crect%20x='304'%20y='48'%20width='16'%20height='16'%20fill='%23fff'%20opacity='0.88'/%3E%3Crect%20x='128'%20y='64'%20width='16'%20height='16'%20fill='%23fff'%20opacity='0.02'/%3E%3Crect%20x='144'%20y='64'%20width='16'%20height='16'%20fill='%23fff'%20opacity='0.04'/%3E%3Crect%20x='160'%20y='64'%20width='16'%20height='16'%20fill='%23fff'%20opacity='0.17'/%3E%3Crect%20x='176'%20y='64'%20width='16'%20height='16'%20fill='%23fff'%20opacity='0.27'/%3E%3Crect%20x='192'%20y='64'%20width='16'%20height='16'%20fill='%23fff'%20opacity='0.32'/%3E%3Crect%20x='208'%20y='64'%20width='16'%20height='16'%20fill='%23fff'%20opacity='0.27'/%3E%3Crect%20x='224'%20y='64'%20width='16'%20height='16'%20fill='%23fff'%20opacity='0.29'/%3E%3Crect%20x='240'%20y='64'%20width='16'%20height='16'%20fill='%23fff'%20opacity='0.43'/%3E%3Crect%20x='256'%20y='64'%20width='16'%20height='16'%20fill='%23fff'%20opacity='0.61'/%3E%3Crect%20x='272'%20y='64'%20width='16'%20height='16'%20fill='%23fff'%20opacity='0.55'/%3E%3Crect%20x='288'%20y='64'%20width='16'%20height='16'%20fill='%23fff'%20opacity='0.65'/%3E%3Crect%20x='304'%20y='64'%20width='16'%20height='16'%20fill='%23fff'%20opacity='0.95'/%3E%3C/g%3E%3C/svg%3E");background-repeat:no-repeat;background-position:right top;background-size:auto 100%;color:#FFF;padding:0;text-align:left;display:flex;align-items:center;justify-content:space-between}
.hdr-text{min-width:0;padding:8px 10px;flex:1}
.hdr-back{color:#fff;opacity:.8;font-size:11px;text-decoration:none;padding:8px 10px;white-space:nowrap}.hdr-back:hover{opacity:1;text-decoration:underline}
h1{font-family:Impact,Haettenschweiler,"Arial Black",sans-serif;font-size:32px;border:0;padding:0;margin:0;letter-spacing:1px;color:#FFF;text-shadow:none;line-height:1}
.sub{font-family:'Trebuchet MS',Arial,sans-serif;background-color:#1a3f77;color:#EEE;font-size:12px;margin:4px 0 0;padding:2px 6px;display:inline-block}
h2{font-family:"Trebuchet MS",Tahoma,Arial,sans-serif;background-color:#6699cc;background-image:url("data:image/svg+xml,%3Csvg%20xmlns='http://www.w3.org/2000/svg'%20width='224'%20height='24'%20viewBox='0%200%20224%2024'%20shape-rendering='crispEdges'%3E%3Cdefs%3E%3ClinearGradient%20id='m'%20x1='0%2525'%20y1='0%2525'%20x2='100%2525'%20y2='0%2525'%3E%3Cstop%20offset='0%2525'%20stop-color='%23000'%20stop-opacity='0'/%3E%3Cstop%20offset='46%2525'%20stop-color='%23000'%20stop-opacity='0'/%3E%3Cstop%20offset='78%2525'%20stop-color='%23fff'%20stop-opacity='1'/%3E%3Cstop%20offset='100%2525'%20stop-color='%23fff'%20stop-opacity='1'/%3E%3C/linearGradient%3E%3Cmask%20id='fade'%3E%3Crect%20width='224'%20height='24'%20fill='url(%23m)'/%3E%3C/mask%3E%3C/defs%3E%3Cg%20mask='url(%23fade)'%3E%3Crect%20x='88'%20y='0'%20width='8'%20height='8'%20fill='%23fff'%20opacity='0.02'/%3E%3Crect%20x='96'%20y='0'%20width='8'%20height='8'%20fill='%23fff'%20opacity='0.05'/%3E%3Crect%20x='104'%20y='0'%20width='8'%20height='8'%20fill='%23fff'%20opacity='0.02'/%3E%3Crect%20x='112'%20y='0'%20width='8'%20height='8'%20fill='%23fff'%20opacity='0.04'/%3E%3Crect%20x='120'%20y='0'%20width='8'%20height='8'%20fill='%23fff'%20opacity='0.18'/%3E%3Crect%20x='128'%20y='0'%20width='8'%20height='8'%20fill='%23fff'%20opacity='0.31'/%3E%3Crect%20x='136'%20y='0'%20width='8'%20height='8'%20fill='%23fff'%20opacity='0.25'/%3E%3Crect%20x='144'%20y='0'%20width='8'%20height='8'%20fill='%23fff'%20opacity='0.27'/%3E%3Crect%20x='152'%20y='0'%20width='8'%20height='8'%20fill='%23fff'%20opacity='0.38'/%3E%3Crect%20x='160'%20y='0'%20width='8'%20height='8'%20fill='%23fff'%20opacity='0.43'/%3E%3Crect%20x='168'%20y='0'%20width='8'%20height='8'%20fill='%23fff'%20opacity='0.5'/%3E%3Crect%20x='176'%20y='0'%20width='8'%20height='8'%20fill='%23fff'%20opacity='0.48'/%3E%3Crect%20x='184'%20y='0'%20width='8'%20height='8'%20fill='%23fff'%20opacity='0.74'/%3E%3Crect%20x='192'%20y='0'%20width='8'%20height='8'%20fill='%23fff'%20opacity='0.5'/%3E%3Crect%20x='200'%20y='0'%20width='8'%20height='8'%20fill='%23fff'%20opacity='0.5'/%3E%3Crect%20x='208'%20y='0'%20width='8'%20height='8'%20fill='%23fff'%20opacity='0.82'/%3E%3Crect%20x='216'%20y='0'%20width='8'%20height='8'%20fill='%23fff'%20opacity='0.65'/%3E%3Crect%20x='88'%20y='8'%20width='8'%20height='8'%20fill='%23fff'%20opacity='0.02'/%3E%3Crect%20x='96'%20y='8'%20width='8'%20height='8'%20fill='%23fff'%20opacity='0.06'/%3E%3Crect%20x='104'%20y='8'%20width='8'%20height='8'%20fill='%23fff'%20opacity='0.12'/%3E%3Crect%20x='112'%20y='8'%20width='8'%20height='8'%20fill='%23fff'%20opacity='0.16'/%3E%3Crect%20x='120'%20y='8'%20width='8'%20height='8'%20fill='%23fff'%20opacity='0.23'/%3E%3Crect%20x='128'%20y='8'%20width='8'%20height='8'%20fill='%23fff'%20opacity='0.26'/%3E%3Crect%20x='136'%20y='8'%20width='8'%20height='8'%20fill='%23fff'%20opacity='0.28'/%3E%3Crect%20x='144'%20y='8'%20width='8'%20height='8'%20fill='%23fff'%20opacity='0.12'/%3E%3Crect%20x='152'%20y='8'%20width='8'%20height='8'%20fill='%23fff'%20opacity='0.5'/%3E%3Crect%20x='160'%20y='8'%20width='8'%20height='8'%20fill='%23fff'%20opacity='0.36'/%3E%3Crect%20x='168'%20y='8'%20width='8'%20height='8'%20fill='%23fff'%20opacity='0.58'/%3E%3Crect%20x='176'%20y='8'%20width='8'%20height='8'%20fill='%23fff'%20opacity='0.6'/%3E%3Crect%20x='184'%20y='8'%20width='8'%20height='8'%20fill='%23fff'%20opacity='0.67'/%3E%3Crect%20x='192'%20y='8'%20width='8'%20height='8'%20fill='%23fff'%20opacity='0.74'/%3E%3Crect%20x='200'%20y='8'%20width='8'%20height='8'%20fill='%23fff'%20opacity='0.78'/%3E%3Crect%20x='208'%20y='8'%20width='8'%20height='8'%20fill='%23fff'%20opacity='0.59'/%3E%3Crect%20x='216'%20y='8'%20width='8'%20height='8'%20fill='%23fff'%20opacity='0.7'/%3E%3Crect%20x='88'%20y='16'%20width='8'%20height='8'%20fill='%23fff'%20opacity='0.02'/%3E%3Crect%20x='96'%20y='16'%20width='8'%20height='8'%20fill='%23fff'%20opacity='0.06'/%3E%3Crect%20x='104'%20y='16'%20width='8'%20height='8'%20fill='%23fff'%20opacity='0.1'/%3E%3Crect%20x='112'%20y='16'%20width='8'%20height='8'%20fill='%23fff'%20opacity='0.19'/%3E%3Crect%20x='120'%20y='16'%20width='8'%20height='8'%20fill='%23fff'%20opacity='0.25'/%3E%3Crect%20x='128'%20y='16'%20width='8'%20height='8'%20fill='%23fff'%20opacity='0.17'/%3E%3Crect%20x='136'%20y='16'%20width='8'%20height='8'%20fill='%23fff'%20opacity='0.34'/%3E%3Crect%20x='144'%20y='16'%20width='8'%20height='8'%20fill='%23fff'%20opacity='0.44'/%3E%3Crect%20x='152'%20y='16'%20width='8'%20height='8'%20fill='%23fff'%20opacity='0.36'/%3E%3Crect%20x='160'%20y='16'%20width='8'%20height='8'%20fill='%23fff'%20opacity='0.44'/%3E%3Crect%20x='168'%20y='16'%20width='8'%20height='8'%20fill='%23fff'%20opacity='0.45'/%3E%3Crect%20x='176'%20y='16'%20width='8'%20height='8'%20fill='%23fff'%20opacity='0.69'/%3E%3Crect%20x='184'%20y='16'%20width='8'%20height='8'%20fill='%23fff'%20opacity='0.71'/%3E%3Crect%20x='192'%20y='16'%20width='8'%20height='8'%20fill='%23fff'%20opacity='0.72'/%3E%3Crect%20x='200'%20y='16'%20width='8'%20height='8'%20fill='%23fff'%20opacity='0.79'/%3E%3Crect%20x='208'%20y='16'%20width='8'%20height='8'%20fill='%23fff'%20opacity='0.9'/%3E%3Crect%20x='216'%20y='16'%20width='8'%20height='8'%20fill='%23fff'%20opacity='0.33'/%3E%3C/g%3E%3C/svg%3E");background-repeat:no-repeat;background-position:right top;background-size:auto 100%;border:0;padding:3px 6px;color:#FFF;margin:16px 0 8px;font-size:14px;text-transform:uppercase;letter-spacing:1px}
#resultsHeader{display:flex;align-items:center;justify-content:space-between;gap:10px}
#count{margin-left:auto}
h3{font-family:Tahoma,Verdana,sans-serif;font-size:11px;font-weight:bold;margin:12px 0 6px;text-transform:uppercase;letter-spacing:1px;color:#333}
a{color:#1d4ed8;text-decoration:underline}a:visited{color:#551A8B}a:hover{color:#cc0000;text-decoration:none}
hr{border:0;height:1px;background:#cbd5e1;margin:16px 0}
footer{font-size:10px;border:0;padding:10px 0;color:#64748b}
#q{width:100%;padding:6px 10px;font:inherit;font-size:13px;border:1px solid #94a3b8;background:#fff;color:#0b1020;margin:10px 0}
#q:focus{outline:2px solid #4a7fc4;border-color:#4a7fc4}
.modes{display:flex;gap:4px;flex-wrap:wrap;margin:8px 0}
.mode-btn{background:#e2e8f0;border:1px solid #94a3b8;color:#0b1020;padding:4px 8px;font-size:11px;font-weight:bold;cursor:pointer;text-transform:uppercase;letter-spacing:.5px}
.mode-btn:hover{background:#cbd5e1}
.mode-btn.active{background:#4a7fc4;color:#fff;border-color:#4a7fc4}
.results{list-style:none;margin:0;padding:0;display:flex;flex-wrap:wrap;gap:8px}
.results li{padding:8px 10px;cursor:pointer;background:#fff;border:1px solid #cbd5e1;min-width:180px;flex:1 1 calc(33.333% - 8px)}
.results li:hover{background:#e2e8f0}
.results li.active{background:#4a7fc4;color:#fff;border-color:#4a7fc4}
.results li.active .score{background:rgba(255,255,255,.3);color:#fff}
.results li.active mark{color:#fff;background:transparent}
.results li strong{color:#0b1020;font-size:14px}
.results li.active strong{color:#fff}
.desc{color:#555;font-size:11px;margin-top:4px;font-style:italic}
.results li.active .desc{color:rgba(255,255,255,.85)}
mark{background:transparent;color:#cc0000;font-weight:bold}
.score{font-size:10px;font-weight:bold;padding:2px 5px;background:#e2e8f0;margin-right:6px;display:inline-block;min-width:36px;text-align:center}
.syl-wrap{display:inline-flex;gap:3px;margin-left:6px;flex-wrap:wrap}
.syl{background:#e2e8f0;padding:2px 5px;font-size:10px;font-weight:bold}
.badge{background:#e2e8f0;color:#64748b;padding:2px 5px;font-size:10px;font-weight:bold}
.meta{font-size:10px;color:#64748b;font-weight:bold}
.stats-bar{font-size:11px;color:#64748b;padding:8px 0;border-top:1px solid #cbd5e1;margin-top:10px}
.loader{padding:10px;font-size:12px;color:#64748b}
.error{color:#b91c1c;font-weight:bold}
.empty{color:#64748b;font-style:italic;padding:20px;text-align:center;border:1px dashed #cbd5e1;background:#fff}
.wotd{background:#fff;border:1px solid #cbd5e1;padding:10px;margin:10px 0;display:inline-block}
.wotd-title{font-size:10px;text-transform:uppercase;letter-spacing:1px;font-weight:bold;color:#64748b}
.wotd-word{font-size:18px;font-weight:bold;color:#0b1020}
.wotd-extra{font-size:11px;color:#64748b}
.overlay{position:fixed;inset:0;background:rgba(0,0,0,.7);display:none;align-items:center;justify-content:center;z-index:200}
.overlay.active{display:flex}
.game-box{width:min(420px,90%);background:#fff;border:2px solid #4a7fc4;padding:16px;position:relative}
.game-box h2{margin:0 0 12px;font-size:16px;background:none;color:#0b1020;padding:0}
.game-close{position:absolute;top:8px;right:12px;background:none;border:none;color:#64748b;font-size:20px;cursor:pointer;font-weight:bold}
.game-close:hover{color:#b91c1c}
.game-grid{display:grid;grid-template-columns:repeat(5,1fr);gap:4px;margin-bottom:12px}
.cell{aspect-ratio:1/1;display:flex;align-items:center;justify-content:center;font-weight:bold;font-size:16px;border:2px solid #cbd5e1;background:#fff;color:#0b1020}
.cell.state-correct{background:#22c55e;border-color:#22c55e;color:#fff}
.cell.state-present{background:#eab308;border-color:#eab308;color:#fff}
.cell.state-miss{background:#94a3b8;color:#fff;border-color:#94a3b8}
.game-actions{display:flex;gap:6px;margin-bottom:8px}
.game-actions input{flex:1;padding:6px 8px;border:1px solid #94a3b8;font:inherit;font-size:13px}
.game-actions input:focus{outline:2px solid #4a7fc4;border-color:#4a7fc4}
.game-actions button{background:#4a7fc4;border:none;color:#fff;padding:6px 12px;font:inherit;font-weight:bold;cursor:pointer}
.game-actions button:hover{background:#3b6ba8}
.game-status{font-size:12px;color:#64748b;min-height:18px;font-weight:bold}
.game-hint{font-size:10px;color:#94a3b8;margin-top:8px}

@media(max-width:600px){
body{margin:0;font-size:16px}
.page{border-width:0;max-width:100%}
.content{margin:12px}
h1{font-size:26px}
.hdr{flex-wrap:wrap}
.hdr-text{padding:8px;min-width:0}
.hdr-back{padding:8px 10px;font-size:12px}
#q{padding:10px 12px;font-size:16px}
.modes{gap:6px 6px}
.mode-btn{padding:10px 10px;font-size:12px}
.results{gap:10px}
.results li{flex:1 1 100%;min-width:0}
}
</style>
</head>
<body>
<div class="page">
<div class="hdr">
<div class="hdr-text">
<h1>Македонски Лексикон</h1>
<div class="sub">Истражувајте го богатството на македонскиот јазик</div>
</div>
<a href="../" class="hdr-back">« Назад кон почетна</a>
</div>
<div class="content">
<input id="q" type="text" placeholder="Пребарувај збор…" autocomplete="off" autofocus>
<div class="modes" id="modes">
<button class="mode-btn active" data-mode="search">Пребарување</button>
<button class="mode-btn" data-mode="startswith">Почнува со</button>
<button class="mode-btn" data-mode="endswith">Завршува со</button>
<button class="mode-btn" data-mode="contains">Содржи</button>
<button class="mode-btn" data-mode="rhyme">Рима</button>
<button class="mode-btn" data-mode="anagram">Анаграми</button>
<button class="mode-btn" data-mode="syllable">Слогови</button>
<button class="mode-btn" data-mode="zborle">Зборле</button>
<button class="mode-btn" data-mode="hangman">Бесилка</button>
<button class="mode-btn" data-mode="resle">Решле</button>
</div>
<div id="resultsPanel">
<h2 id="resultsHeader"><span>Резултати</span> <span id="count"></span></h2>
<div id="loader" class="loader">Го вчитуваме корпусот…</div>
<ul class="results" id="results" hidden></ul>
<div class="stats-bar" id="stats" hidden></div>
</div>
<div id="wotdCard" class="wotd" hidden>
<div class="wotd-title"> Збор на денот</div>
<div class="wotd-word" id="wotdWord"></div>
<div class="wotd-extra" id="wotdExtra"></div>
</div>
<hr>
<footer>Македонски Лексикон  Алатка за истражување на македонскиот јазик</footer>
</div>
</div>
<div class="overlay" id="gameOverlay">
<div class="game-box">
<button class="game-close" id="gameClose"></button>
<h2>Зборле  Погодете го зборот</h2>
<div class="game-grid" id="gameGrid"></div>
<div class="game-actions">
<input id="gameInput" type="text" maxlength="10" placeholder="Внеси збор (5 букви)">
<button id="gameSubmit">Потврди</button>
</div>
<div class="game-status" id="gameStatus"></div>
<div class="game-hint">Зелено: точна позиција  Жолто: друга позиција  Сиво: нема</div>
</div>
</div>
<div class="overlay" id="hangOverlay">
<div class="game-box">
<button class="game-close" id="hangClose"></button>
<h2>Бесилка  Погодете букви</h2>
<div id="hangWord" style="display:flex;gap:4px;flex-wrap:wrap;font-weight:bold;letter-spacing:2px;margin-bottom:10px"></div>
<div class="game-actions">
<input id="hangInput" type="text" maxlength="1" placeholder="Буква">
<button id="hangSubmit">Погоди</button>
</div>
<div class="game-status" id="hangStatus"></div>
<div class="game-hint">Грешки: <span id="hangWrongCnt">0</span>/6  Погрешни: <span id="hangWrongList"></span></div>
</div>
</div>
<div class="overlay" id="resleOverlay">
<div class="game-box">
<button class="game-close" id="resleClose"></button>
<h2>Решле  Асистент за Зборле</h2>
<div id="resleRow" style="display:grid;grid-template-columns:repeat(5,1fr);gap:4px;margin-bottom:10px"></div>
<div class="game-actions">
<input id="resleInput" type="text" maxlength="5" placeholder="Внеси обид (5 букви)">
<button id="resleApply">Примени</button>
<button id="resleReset">Ресетирај</button>
</div>
<div class="game-status" id="resleStatus"></div>
<div class="game-hint">Клик на буква: сиво  жолто  зелено</div>
<div id="resleCount" style="font-weight:bold;margin:8px 0"></div>
<div id="resleSuggest" style="display:flex;gap:4px;flex-wrap:wrap"></div>
</div>
</div>
<script>
(function(){
const input=document.getElementById('q'),resultsEl=document.getElementById('results'),loader=document.getElementById('loader'),countEl=document.getElementById('count'),statsEl=document.getElementById('stats');
let DATA=[],INDEX=[],CURRENT_MODE='search',SIG_INDEX=new Map,RHYME_INDEX=new Map,WORD_MAP=new Map,SUFFIX2=new Map,SUFFIX3=new Map;
let ADV_BUILT=false;
const vowels='аеоиуАЕОИУ';
function normalize(raw){if(!raw)return[];if(Array.isArray(raw)){if(!raw.length)return[];if(typeof raw[0]==='string')return raw.map(w=>({word:w,props:{}}));const first=raw[0];let keyCandidate=Object.keys(first).find(k=>/^(word|lemma|forma|zbor)$/i.test(k));if(!keyCandidate)keyCandidate=Object.keys(first)[0];return raw.map(o=>({word:String(o[keyCandidate]),props:o}))}if(typeof raw==='object')return Object.keys(raw).map(k=>({word:k,props:raw[k]}));return[]}
function buildIndex(items){INDEX=items.map(it=>({w:it.word,wl:it.word.toLowerCase(),props:it.props}))}
function ensureAdvancedIndexes(){
	if(ADV_BUILT) return;
	buildAdvancedIndexes();
	ADV_BUILT=true;
}
function scheduleAdvancedIndexes(){
	if(ADV_BUILT) return;
	const run=()=>{try{ensureAdvancedIndexes()}catch(_){/* ignore */}};
	if('requestIdleCallback' in window) window.requestIdleCallback(run,{timeout:1500});
	else setTimeout(run,250);
}
function buildAdvancedIndexes(){SIG_INDEX.clear();RHYME_INDEX.clear();WORD_MAP.clear();SUFFIX2.clear();SUFFIX3.clear();for(const rec of INDEX){WORD_MAP.set(rec.w.toLowerCase(),rec);const sig=signature(rec.w);if(!SIG_INDEX.has(sig))SIG_INDEX.set(sig,[]);SIG_INDEX.get(sig).push(rec.w);const varList=variantsForRhyme(rec.w);for(const v of varList){const rk=rhymeKey(v);if(!RHYME_INDEX.has(rk))RHYME_INDEX.set(rk,new Set);RHYME_INDEX.get(rk).add(rec.w)}const wl=rec.w.toLowerCase();if(wl.length>=2){const s2=wl.slice(-2);if(!SUFFIX2.has(s2))SUFFIX2.set(s2,new Set);SUFFIX2.get(s2).add(rec.w)}if(wl.length>=3){const s3=wl.slice(-3);if(!SUFFIX3.has(s3))SUFFIX3.set(s3,new Set);SUFFIX3.get(s3).add(rec.w)}}for(const[k,arrSet]of RHYME_INDEX.entries()){const arr=Array.from(arrSet);arr.sort((a,b)=>a.length-b.length||a.localeCompare(b,'mk'));RHYME_INDEX.set(k,arr)}for(const arr of SIG_INDEX.values())arr.sort((a,b)=>a.length-b.length||a.localeCompare(b,'mk'));for(const[k,set]of SUFFIX2.entries())SUFFIX2.set(k,Array.from(set));for(const[k,set]of SUFFIX3.entries())SUFFIX3.set(k,Array.from(set))}
function variantsForRhyme(word){const w=word.toLowerCase(),variants=new Set([w]);if(!w.endsWith('а'))variants.add(w+'а');if(w.endsWith('а')&&w.length>3)variants.add(w.slice(0,-1));variants.add(w+'от');variants.add(w+'та');variants.add(w+'те');variants.add(w+'ите');variants.add(w+'ови');variants.add(w+'еви');return Array.from(variants)}
function rhymeKey(word){const w=word.toLowerCase();for(let i=w.length-1;i>=0;i--)if(vowels.includes(w[i]))return w.slice(i);return w}
function signature(word){const cleaned=word.toLowerCase().replace(/[^абвгдѓежзѕијклљмнњопрстќуфхцчџш]/g,'');return[...cleaned].sort().join('')}
function syllables(word){const raw=(word||'').toLowerCase().replace(/[^абвгдѓежзѕијклљмнњопрстќуфхцчџш]/g,'');const n=raw.length;if(!n)return[];const baseVowels=new Set(['а','е','и','о','у']);const isVowelAt=i=>{const ch=raw[i];if(baseVowels.has(ch))return true;if(ch==='р'){const prev=i>0?raw[i-1]:'';const next=i<n-1?raw[i+1]:'';const prevCons=prev&&!baseVowels.has(prev)&&prev!=='р';const nextCons=next&&!baseVowels.has(next)&&next!=='р';if(prevCons&&nextCons)return true}return false};const vowelIdx=[];for(let i=0;i<n;i++)if(isVowelAt(i))vowelIdx.push(i);if(!vowelIdx.length)return[raw];const parts=[];let start=0;for(let k=0;k<vowelIdx.length-1;k++){const v1=vowelIdx[k],v2=vowelIdx[k+1],between=raw.slice(v1+1,v2);if(!between.length){parts.push(raw.slice(start,v1+1));start=v1+1;continue}const b=[...between];let onsetLen=1;const candidate2=b.slice(-2).join('');const isAllowed2=candidate2.length===2&&(candidate2[1]==='р'||candidate2[1]==='л');if(isAllowed2&&candidate2[0]!=='с')onsetLen=2;const cut=v2-onsetLen;parts.push(raw.slice(start,cut));start=cut}if(start<n)parts.push(raw.slice(start));return parts}
function levenshtein(a,b){if(a===b)return 0;const al=a.length,bl=b.length;if(!al)return bl;if(!bl)return al;let prev=new Array(bl+1),cur=new Array(bl+1);for(let j=0;j<=bl;j++)prev[j]=j;for(let i=1;i<=al;i++){cur[0]=i;const ac=a[i-1];for(let j=1;j<=bl;j++){const cost=ac===b[j-1]?0:1;cur[j]=Math.min(prev[j]+1,cur[j-1]+1,prev[j-1]+cost)}prev=cur.slice()}return prev[bl]}
function similarityPct(query,word){const maxLen=Math.max(query.length,word.length);if(!maxLen)return 0;return Math.round((1-levenshtein(query,word.toLowerCase())/maxLen)*100)}
function suffixMatchPct(query,word){let i=query.length-1,j=word.length-1,match=0;const ql=query.toLowerCase(),wl=word.toLowerCase();while(i>=0&&j>=0&&ql[i]===wl[j]){match++;i--;j--}return Math.round((match/Math.max(ql.length,wl.length))*100)}
function escapeHtml(s){return s.replace(/[&<>"']/g,c=>({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;','\'':'&#39;'}[c]))}
function escapeRegex(s){return s.replace(/[.*+?^${}()|[\]\\]/g,r=>'\\'+r)}
function highlight(word,query){if(!query)return escapeHtml(word);const re=new RegExp('('+escapeRegex(query)+')','ig');return escapeHtml(word).replace(re,'<mark>$1</mark>')}
function search(q){
	const t0=performance.now(),query=q.trim().toLowerCase();
	if(!query) return{q:query,time:0,total:0,hits:[]};
	let subset=[];
	if(CURRENT_MODE==='search'){
		subset=INDEX.map(rec=>{const pos=rec.wl.indexOf(query),sim=similarityPct(query,rec.wl),posBonus=pos===-1?0:Math.max(0,30-pos*2),lengthPenalty=Math.max(0,rec.wl.length-query.length)*0.5,composite=sim+posBonus-lengthPenalty;return{rec,simPct:sim,composite}}).filter(x=>x.simPct>40||query.length<3&&x.rec.wl.includes(query)).sort((a,b)=>b.composite-a.composite).slice(0,150)
	}else if(CURRENT_MODE==='startswith'){
		subset=INDEX.filter(rec=>rec.wl.startsWith(query)).map(rec=>({rec,simPct:100,composite:100-rec.wl.length})).sort((a,b)=>b.composite-a.composite).slice(0,150)
	}else if(CURRENT_MODE==='endswith'){
		subset=INDEX.filter(rec=>rec.wl.endsWith(query)).map(rec=>({rec,simPct:100,composite:100-rec.wl.length})).sort((a,b)=>b.composite-a.composite).slice(0,150)
	}else if(CURRENT_MODE==='contains'){
		subset=INDEX.filter(rec=>rec.wl.includes(query)).map(rec=>{const pos=rec.wl.indexOf(query),posBonus=Math.max(0,30-pos*2),lengthPenalty=(rec.wl.length-query.length)*0.5,composite=100+posBonus-lengthPenalty;return{rec,simPct:100,composite}}).sort((a,b)=>b.composite-a.composite).slice(0,150)
	}else if(CURRENT_MODE==='anagram'){
		ensureAdvancedIndexes();
		const sig=signature(query),words=SIG_INDEX.get(sig)||[];
		subset=words.map(w=>({rec:WORD_MAP.get(w.toLowerCase())||{w,wl:w.toLowerCase(),props:{}},simPct:100,composite:100}))
	}else if(CURRENT_MODE==='rhyme'){
		ensureAdvancedIndexes();
		const base=query.split(/\s+/).pop(),rk=rhymeKey(base),candSet=new Set(RHYME_INDEX.get(rk)||[]);
		if(candSet.size<12){const b3=base.slice(-3),b2=base.slice(-2);if(b3&&SUFFIX3.has(b3))SUFFIX3.get(b3).forEach(w=>candSet.add(w));if(candSet.size<12&&b2&&SUFFIX2.has(b2))SUFFIX2.get(b2).forEach(w=>candSet.add(w))}
		const candidates=Array.from(candSet);
		subset=candidates.map(w=>{const rec=WORD_MAP.get(w.toLowerCase())||{w,wl:w.toLowerCase(),props:{}};const vars=variantsForRhyme(rec.w);let bestPct=0;for(const v of vars){const pct=suffixMatchPct(base,v);if(pct>bestPct)bestPct=pct}const rkMatch=rec.w.toLowerCase().endsWith(rk)?15:0,composite=bestPct+rkMatch;return{rec,simPct:bestPct,composite}}).filter(x=>x.simPct>0).sort((a,b)=>b.simPct!==a.simPct?b.simPct-a.simPct:b.composite-a.composite).slice(0,120)
	}else if(CURRENT_MODE==='syllable'){
		const base=query.split(/\s+/)[0],baseSyl=syllables(base),count=baseSyl.length;
		const pool=INDEX.filter(r=>r.w!==base&&syllables(r.w).length===count).slice(0,150);
		subset=[{rec:{w:base,wl:base.toLowerCase(),props:{}},simPct:100,composite:100,syl:baseSyl}].concat(pool.map(r=>({rec:r,simPct:100,composite:100,syl:syllables(r.w)})))
	}
	const hits=subset.map(item=>item.rec?item:{rec:item,simPct:0});
	return{q:query,time:(performance.now()-t0).toFixed(2),total:hits.length,hits}
}
function renderCardProps(props){if(!props||typeof props!=='object'||!Object.keys(props).length)return{type:'',description:''};const typeKey=Object.keys(props).find(k=>/^(pos|tag|вид|кат|type|category)$/i.test(k));const type=typeKey?String(props[typeKey]):'';const descKey=Object.keys(props).find(k=>/^(desc|description|опис|дефиниција|значење)$/i.test(k));const description=descKey?String(props[descKey]):'';return{type,description}}
function renderResults(q){
	const wotdCard=document.getElementById('wotdCard');
	const panel=document.getElementById('resultsPanel');
	const hdr=document.getElementById('resultsHeader');
	const loaderEl=document.getElementById('loader');

	if(!q.trim()){
		resultsEl.innerHTML='';
		resultsEl.hidden=true;
		countEl.textContent='';
		statsEl.hidden=true;
		statsEl.textContent='Внесете збор…';
		if(hdr) hdr.hidden=true;
		if(panel) panel.hidden=!loaderEl;
		if(wotdCard) wotdCard.hidden=false;
		return;
	}

	if(panel) panel.hidden=false;
	if(hdr) hdr.hidden=false;
	if(wotdCard) wotdCard.hidden=true;

	const{hits,total,time}=search(q);
	resultsEl.innerHTML=hits.map(h=>{
		const rec=h.rec||h,pct=h.simPct??0;
		const{type,description}=renderCardProps(rec.props);
		if(CURRENT_MODE==='syllable'){
			const syl=h.syl||syllables(rec.w);
			const sylMarkup=syl.map(s=>'<span class="syl">'+escapeHtml(s)+'</span>').join('');
			return'<li data-w="'+encodeURIComponent(rec.w)+'"><div style="display:flex;align-items:center;gap:6px;flex-wrap:wrap"><span class="score">'+syl.length+' сл.</span><strong>'+highlight(rec.w,q)+'</strong>'+(type?'<span class="badge">'+escapeHtml(type)+'</span>':'')+'</div><div class="syl-wrap">'+sylMarkup+'</div>'+(description?'<div class="desc">'+escapeHtml(description)+'</div>':'')+'</li>'
		}
		return'<li data-w="'+encodeURIComponent(rec.w)+'"><div style="display:flex;align-items:center;gap:6px;flex-wrap:wrap"><span class="score">'+pct+'%</span><strong>'+highlight(rec.w,q)+'</strong>'+(type?'<span class="badge">'+escapeHtml(type)+'</span>':'')+'</div>'+(description?'<div class="desc">'+escapeHtml(description)+'</div>':'')+'</li>'
	}).join('');
	resultsEl.hidden=false;
	countEl.textContent='('+total+')';
	statsEl.hidden=false;
	const msgBase=CURRENT_MODE==='search'?'Резултати':CURRENT_MODE==='startswith'?'Почнува со':CURRENT_MODE==='endswith'?'Завршува со':CURRENT_MODE==='contains'?'Содржи':CURRENT_MODE==='rhyme'?'Рими':CURRENT_MODE==='anagram'?'Анаграми':'Слогови';
	statsEl.textContent=msgBase+': '+total+'  '+time+'ms'
}
function showDetail(word){Array.from(resultsEl.children).forEach(li=>li.classList.toggle('active',decodeURIComponent(li.dataset.w)===word))}
let debounceTimer=null;
input.addEventListener('input',()=>{clearTimeout(debounceTimer);debounceTimer=setTimeout(()=>renderResults(input.value),35)});
resultsEl.addEventListener('click',e=>{const li=e.target.closest('li');if(li)showDetail(decodeURIComponent(li.dataset.w))});
document.getElementById('modes').addEventListener('click',e=>{const btn=e.target.closest('.mode-btn');if(!btn)return;const newMode=btn.dataset.mode;if(!newMode)return;if(newMode==='zborle'){openGame();return}if(newMode==='hangman'){openHangman();return}if(newMode==='resle'){openResle();return}if(newMode===CURRENT_MODE)return;CURRENT_MODE=newMode;document.querySelectorAll('.mode-btn').forEach(b=>b.classList.toggle('active',b===btn));input.placeholder=newMode==='search'?'Пребарувај збор…':newMode==='startswith'?'Внеси почеток…':newMode==='endswith'?'Внеси крај…':newMode==='contains'?'Внеси дел…':newMode==='rhyme'?'Внеси збор за рима…':newMode==='anagram'?'Внеси збор за анаграм…':'Внеси збор за слогови…';resultsEl.innerHTML='';countEl.textContent='';statsEl.textContent='Внесете збор…';input.focus();renderResults(input.value)});
fetch('korpus.json',{cache:'force-cache'}).then(r=>r.json()).then(raw=>{
	DATA=normalize(raw);
	buildIndex(DATA);
	loader.remove();
	input.focus();
	statsEl.hidden=false;
	statsEl.textContent='Вчитани '+INDEX.length+' зборови';
	initWordOfDay();
	initGames();
	renderResults(input.value);
	// Build heavier indexes off the critical path.
	scheduleAdvancedIndexes();
}).catch(err=>{loader.innerHTML='<span class="error">Грешка: '+escapeHtml(err.message)+'</span>'});
function initWordOfDay(){const key='mk_wotd_'+new Date().toISOString().slice(0,10);let w=localStorage.getItem(key);if(!w){const pool=INDEX.filter(r=>r.w.length>=5&&r.w.length<=10);w=pool[Math.floor(Math.random()*pool.length)]?.w||INDEX[0].w;localStorage.setItem(key,w)}const card=document.getElementById('wotdCard'),wordEl=document.getElementById('wotdWord'),extraEl=document.getElementById('wotdExtra');if(!card||!wordEl||!extraEl)return;wordEl.textContent=w;const entry=INDEX.find(r=>r.w===w);const{type}=entry?renderCardProps(entry.props):{type:''};const syls=syllables(w);extraEl.textContent=[type,syls.length+' слогови'].filter(Boolean).join('  ');card.hidden=false}
let GAME_TARGET='',GAME_ATTEMPTS=[];const MAX_ROWS=6;let HANG_TARGET='',HANG_GUESSED=new Set,HANG_WRONG=new Set;const HANG_MAX=6;let RESLE_HISTORY=[],RESLE_CAND=[];
function initGames(){chooseGameTarget();chooseHangmanTarget();initResleCandidates();document.getElementById('gameClose').onclick=closeGame;document.getElementById('gameSubmit').onclick=submitGameGuess;document.getElementById('gameInput').onkeydown=e=>{if(e.key==='Enter')submitGameGuess()};document.getElementById('hangClose').onclick=closeHangman;document.getElementById('hangSubmit').onclick=submitHangGuess;document.getElementById('hangInput').onkeydown=e=>{if(e.key==='Enter')submitHangGuess()};document.getElementById('resleClose').onclick=closeResle;document.getElementById('resleApply').onclick=applyResleStep;document.getElementById('resleReset').onclick=initResleCandidates;document.getElementById('resleInput').oninput=syncResleInputToCells;const row=document.getElementById('resleRow');for(let i=0;i<5;i++){const cell=document.createElement('div');cell.className='cell';cell.dataset.state='0';cell.onclick=()=>{const s=(parseInt(cell.dataset.state,10)+1)%3;cell.dataset.state=String(s);applyCellStateClass(cell)};row.appendChild(cell)}document.getElementById('gameOverlay').onclick=e=>{if(e.target.id==='gameOverlay')closeGame()};document.getElementById('hangOverlay').onclick=e=>{if(e.target.id==='hangOverlay')closeHangman()};document.getElementById('resleOverlay').onclick=e=>{if(e.target.id==='resleOverlay')closeResle()}}
function validGameWords(){return INDEX.filter(r=>r.w.length===5&&/^[абвгдѓежзѕијклљмнњопрстќуфхцчџш]+$/i.test(r.w))}
function chooseGameTarget(){const pool=validGameWords();GAME_TARGET=pool[Math.floor(Math.random()*pool.length)]?.w.toLowerCase()||'збори';GAME_ATTEMPTS=[];updateGameStatus('Почни со погодување.');renderGameGrid()}
function openGame(){document.getElementById('gameOverlay').classList.add('active');document.getElementById('gameInput').focus()}
function closeGame(){document.getElementById('gameOverlay').classList.remove('active')}
function renderGameGrid(){const grid=document.getElementById('gameGrid');grid.innerHTML='';for(let row=0;row<MAX_ROWS;row++){const attempt=GAME_ATTEMPTS[row]||'';for(let col=0;col<5;col++){const ch=attempt[col]||'';const cell=document.createElement('div');cell.className='cell';cell.textContent=ch.toUpperCase();if(attempt&&ch){if(GAME_TARGET[col]===ch)cell.classList.add('state-correct');else if(GAME_TARGET.includes(ch))cell.classList.add('state-present');else cell.classList.add('state-miss')}grid.appendChild(cell)}}}
function submitGameGuess(){const inp=document.getElementById('gameInput');let g=inp.value.trim().toLowerCase();if(!g)return;if(!/^[абвгдѓежзѕијклљмнњопрстќуфхцчџш]{5}$/i.test(g)){updateGameStatus('Треба 5 букви (македонски).');return}if(GAME_ATTEMPTS.includes(g)){updateGameStatus('Веќе пробано.');return}const pool=validGameWords().map(r=>r.w.toLowerCase());if(!pool.includes(g)){updateGameStatus('Зборот не е во листата.');return}GAME_ATTEMPTS.push(g);renderGameGrid();inp.value='';if(g===GAME_TARGET)updateGameStatus('Браво! Погоден збор.');else if(GAME_ATTEMPTS.length>=MAX_ROWS)updateGameStatus('Крај. Зборот беше: '+GAME_TARGET.toUpperCase());else updateGameStatus('Погодоци: '+GAME_ATTEMPTS.length+'/'+MAX_ROWS)}
function updateGameStatus(msg){document.getElementById('gameStatus').textContent=msg}
function validHangWords(){return INDEX.filter(r=>r.w.length>=5&&r.w.length<=8&&/^[абвгдѓежзѕијклљмнњопрстќуфхцчџш]+$/i.test(r.w))}
function chooseHangmanTarget(){const pool=validHangWords();HANG_TARGET=(pool[Math.floor(Math.random()*pool.length)]?.w||'зборови').toLowerCase();HANG_GUESSED=new Set;HANG_WRONG=new Set;renderHangman();updateHangStatus('Почни со буква.')}
function openHangman(){document.getElementById('hangOverlay').classList.add('active');document.getElementById('hangInput').focus()}
function closeHangman(){document.getElementById('hangOverlay').classList.remove('active')}
function renderHangman(){const cont=document.getElementById('hangWord');cont.innerHTML='';for(const ch of HANG_TARGET){const box=document.createElement('div');box.className='cell';box.style.width='40px';box.style.height='40px';box.style.aspectRatio='unset';box.textContent=(/[абвгдѓежзѕијклљмнњопрстќуфхцчџш]/.test(ch)&&!HANG_GUESSED.has(ch))?'':ch.toUpperCase();cont.appendChild(box)}document.getElementById('hangWrongCnt').textContent=String(HANG_WRONG.size);document.getElementById('hangWrongList').textContent=Array.from(HANG_WRONG).map(x=>x.toUpperCase()).join(' ')}
function submitHangGuess(){const inp=document.getElementById('hangInput');const ch=(inp.value||'').toLowerCase().replace(/[^абвгдѓежзѕијклљмнњопрстќуфхцчџш]/g,'');inp.value='';if(!ch)return;if(HANG_GUESSED.has(ch)||HANG_WRONG.has(ch)){updateHangStatus('Веќе пробано.');return}if(HANG_TARGET.includes(ch)){HANG_GUESSED.add(ch);updateHangStatus('Добро!')}else{HANG_WRONG.add(ch);updateHangStatus('Нема таква буква.')}renderHangman();const solved=[...HANG_TARGET].every(c=>!/[абвгдѓежзѕијклљмнњопрстќуфхцчџш]/.test(c)||HANG_GUESSED.has(c));if(solved)updateHangStatus('Победа! Зборот е: '+HANG_TARGET.toUpperCase());else if(HANG_WRONG.size>=HANG_MAX)updateHangStatus('Крај. Зборот беше: '+HANG_TARGET.toUpperCase())}
function updateHangStatus(msg){document.getElementById('hangStatus').textContent=msg}
function openResle(){document.getElementById('resleOverlay').classList.add('active');document.getElementById('resleInput').focus();renderResle()}
function closeResle(){document.getElementById('resleOverlay').classList.remove('active')}
function initResleCandidates(){RESLE_HISTORY=[];RESLE_CAND=validGameWords().map(r=>r.w.toLowerCase());renderResle();updateResleStatus('Внеси обид и означи бои.');clearResleRow()}
function clearResleRow(){const row=document.getElementById('resleRow');[...row.children].forEach(c=>{c.textContent='';c.dataset.state='0';applyCellStateClass(c)});document.getElementById('resleInput').value=''}
function applyCellStateClass(cell){cell.classList.remove('state-correct','state-present','state-miss');const s=parseInt(cell.dataset.state,10);if(s===2)cell.classList.add('state-correct');else if(s===1)cell.classList.add('state-present');else cell.classList.add('state-miss')}
function syncResleInputToCells(){const v=(document.getElementById('resleInput').value||'').toLowerCase().replace(/[^абвгдѓежзѕијклљмнњопрстќуфхцчџш]/g,'').slice(0,5);const row=document.getElementById('resleRow');for(let i=0;i<5;i++){row.children[i].textContent=(v[i]||'').toUpperCase()}}
function applyResleStep(){const row=document.getElementById('resleRow');const letters=[],states=[];for(let i=0;i<5;i++){letters.push((row.children[i].textContent||'').toLowerCase());states.push(parseInt(row.children[i].dataset.state,10)||0)}if(letters.join('').length!==5||letters.some(ch=>!ch)){updateResleStatus('Внеси 5 букви.');return}RESLE_HISTORY.push({word:letters.join(''),states});RESLE_CAND=filterResleCandidates(RESLE_HISTORY);renderResle();clearResleRow()}
function renderResle(){document.getElementById('resleCount').textContent='Преостанати: '+RESLE_CAND.length;const sug=document.getElementById('resleSuggest');sug.innerHTML='';rankResleSuggestions(RESLE_CAND).slice(0,10).forEach(w=>{const b=document.createElement('span');b.className='badge';b.textContent=w.toUpperCase();sug.appendChild(b)})}
function updateResleStatus(msg){document.getElementById('resleStatus').textContent=msg}
function filterResleCandidates(history){let pool=validGameWords().map(r=>r.w.toLowerCase());const minCount=new Map,maxCount=new Map,posFixed=Array(5).fill(null),posExclude=Array.from({length:5},()=>new Set);for(const step of history){const localMin=new Map,localGray=new Map;for(let i=0;i<5;i++){const ch=step.word[i],s=step.states[i];if(s===2){posFixed[i]=ch;localMin.set(ch,(localMin.get(ch)||0)+1)}else if(s===1){posExclude[i].add(ch);localMin.set(ch,(localMin.get(ch)||0)+1)}else{localGray.set(ch,(localGray.get(ch)||0)+1);if(!posFixed[i])posExclude[i].add(ch)}}for(const[ch,cnt]of localMin.entries())minCount.set(ch,Math.max(minCount.get(ch)||0,cnt));for(const[ch]of localGray.entries()){const hasMin=localMin.has(ch)||(minCount.get(ch)||0)>0;if(!hasMin)maxCount.set(ch,0);else maxCount.set(ch,Math.min(maxCount.has(ch)?maxCount.get(ch):Infinity,minCount.get(ch)))}}pool=pool.filter(w=>{for(let i=0;i<5;i++){if(posFixed[i]&&w[i]!==posFixed[i])return false;if(posExclude[i].has(w[i])&&(!posFixed[i]||posFixed[i]!==w[i]))return false}const counts=new Map;for(const ch of w)counts.set(ch,(counts.get(ch)||0)+1);for(const[ch,need]of minCount.entries())if((counts.get(ch)||0)<need)return false;for(const[ch,cap]of maxCount.entries()){if(cap===0&&(counts.get(ch)||0)>0)return false;if(cap!==0&&cap!==Infinity&&(counts.get(ch)||0)>cap)return false}return true});return pool}
function rankResleSuggestions(pool){if(pool.length<=1)return pool;const posFreq=Array.from({length:5},()=>new Map),globFreq=new Map;for(const w of pool){const seen=new Set;for(let i=0;i<5;i++){const ch=w[i];posFreq[i].set(ch,(posFreq[i].get(ch)||0)+1);if(!seen.has(ch)){globFreq.set(ch,(globFreq.get(ch)||0)+1);seen.add(ch)}}}return pool.slice().sort((a,b)=>scoreWord(b)-scoreWord(a));function scoreWord(w){let posScore=0,uniqScore=0;const used=new Set;for(let i=0;i<5;i++){const ch=w[i];posScore+=posFreq[i].get(ch)||0;if(!used.has(ch)){uniqScore+=globFreq.get(ch)||0;used.add(ch)}}return posScore+0.5*uniqScore-(5-used.size)*2}}
})();
</script>
</body>
</html>
